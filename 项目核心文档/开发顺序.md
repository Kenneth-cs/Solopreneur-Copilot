根据目前的开发进度和两份核心文档，给出完整的下一步开发方案规划。

---

## 📊 当前状态

| 项目 | 状态 |
|------|------|
| Next.js 项目初始化 | ✅ 完成 |
| 前端 UI 全部页面 | ✅ 完成（Mock 数据） |
| Prisma Schema 草稿 | ✅ 存在但未连接真实 DB |
| MySQL 数据库 | ❌ 未创建 |
| 用户认证系统 | ❌ 未接入 |
| AI 服务接入 | ❌ 未接入 |
| 真实 API 接口 | ❌ 全部是 Mock |

---

## 🗺️ 建议开发顺序（共 4 阶段）

### **第一阶段：地基 — 数据库 + 认证（建议先做）**

**回答你的问题：是的，先建数据库，但要和认证一起做，缺一不可。**

原因：认证决定了 `User` 表的结构，而所有业务数据（Idea/Project/DailyLog）都依赖 `userId` 外键。如果先建业务表，后来发现认证方案改变了 User 字段，就要重新迁移。

**具体任务：**

1.  **MySQL 建库** — 在本地或腾讯云创建数据库实例，配置 `DATABASE_URL`。
2.  **完善 Prisma Schema** — 补全所有表和字段（见下方数据库设计方案）。
3.  **运行 `prisma migrate`** — 生成真实表结构。
4.  **接入 NextAuth.js** — 实现邮箱/密码 + GitHub OAuth 登录，登录页面 UI。
5.  **Sidebar 接入真实用户信息** — 显示真实头像、用户名、计划类型。

---

### **第二阶段：核心功能 — 每日复盘 AI（Phase 1 核心产出）**

这是 PRD 的 P0 优先级，也是整个产品的"灵魂"。

**具体任务：**

1.  **接入火山引擎 API** — 封装 AI 客户端 `src/lib/ai/volcano.ts`。
2.  **编写"灵魂六问" Prompt** — 设计对话状态机，AI 逐步追问 6 个问题。
3.  **实现 `DailyLog` 存储 API** — 对话结束后将问答内容存入 MySQL。
4.  **AI 日报生成** — 根据问答记录生成结构化 Markdown 日报并存储。
5.  **历史记录页** — 查看过去所有日报列表。

---

### **第三阶段：创意验证 — Idea Validator（Phase 2）**

**具体任务：**

1.  **Idea CRUD API** — 创建、查询、删除创意记录，存入 MySQL。
2.  **接入 Serper.dev / Bing Search API** — 实现市场调研真实搜索。
3.  **毒舌 VC 评分 AI** — 基于商业画布内容真实调用 AI 打分，写入 `score` 字段。
4.  **状态流转** — `pending → approved / rejected` 联动 Dashboard 显示。
5.  **Dashboard 数据真实化** — "最近创意验证"列表从 DB 读取。

---

### **第四阶段：项目管理 + 仪表盘数据真实化（Phase 3）**

**具体任务：**

1.  **Project CRUD API** — 从通过的 Idea 一键立项，写入 Deadline 和 MVP 功能。
2.  **Dashboard 核心指标 API** — MRR、活跃用户、净利润从 `ProductMetrics` 表聚合计算。
3.  **邮件通知** — 接入 Resend，倒计时结束前触发报警邮件。
4.  **GitHub Webhook** — 接收 Commit 事件，自动写入 `DailyLog.commitLogs`。

---

## 🗃️ 数据库设计方案（完整版）

以下是相比现有 Prisma Schema **需要补充的关键字段**：

**`User` 表 — 补充认证字段**
```
+ password_hash  (NextAuth 邮箱登录需要)
+ avatar_url     (头像)
+ plan           (free / pro)
+ github_token   (用于拉取 Commit)
+ day_streak     (连续创业天数，Dashboard 显示 "第 142 天")
```

**`Idea` 表 — 补充调研内容字段**
```
+ market_report  (TEXT, AI 生成的市场调研报告 Markdown)
+ vc_comment     (TEXT, 毒舌 VC 的具体评语)
+ canvas_target  (目标用户)
+ canvas_pain    (用户痛点)
+ canvas_revenue (变现模式)
```

**`Project` 表 — 补充任务管理字段**
```
+ status         (active / launched / abandoned)
+ tasks          (JSON, MVP 任务清单及完成状态)
+ live_url       (上线后的产品链接)
+ launch_date    (实际发布日期)
```

**`DailyLog` 表 — 补充 AI 内容字段**
```
+ q1~q6          (6 个灵魂问题的答案，单独存储方便检索)
+ ai_report_md   (AI 生成的完整日报 Markdown)
+ shared_to      (发布到哪些平台：twitter/xiaohongshu)
```

**新增 `UserActivity` 表 — 操作日志（复盘 Agent 数据源）**
```
+ user_id
+ action_type    (create_idea / validate_idea / create_project / launch / daily_log)
+ description
+ created_at
```

---